<section data-controller="exam">
  <%= form_with(model: @exam, local: true, url: admin_exams_manage_index_path, data: { btn_class: "btn-primary" }) do |form| %>
    <div class="flex flex-wrap w-full md:w-1/2 gap-6">
      <label class="form-control w-full">
        <%= form.label :name, class: "label-text" %>
        <%= form.text_field :name, class: "input input-bordered w-full" %>
        <% if flash[:name_error] %>
          <span class="label-text-alt text-error"><%= flash[:name_error] %></span>
        <% end %>
      </label>

      <label class="form-control w-full">
        <%= form.label :quarter_id, "Quarter", class: "label-text" %>
        <%= form.collection_select :quarter_id, @quarters, :id, :name, { prompt: "Select a quarter" }, { class: "select select-bordered w-full" } %>
        <% if flash[:quarter_error] %>
          <span class="label-text-alt text-error"><%= flash[:quarter_error] %></span>
        <% end %>
      </label>

      <label class="form-control w-full">
        <%= form.label :subject_id, "Subject", class: "label-text" %>
        <%= form.collection_select :subject_id, @subjects, :id,
          ->(subject) { "#{subject.name} - #{subject.school_class&.name}" },
          { prompt: "Select a subject" },
          { class: "select select-bordered w-full" } %>
        <% if flash[:subject_error] %>
          <span class="label-text-alt text-error"><%= flash[:subject_error] %></span>
        <% end %>
      </label>
    </div>

    <div class="container mx-auto p-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <% [1..25, 26..50].each_with_index do |range, index| %>
          <div class="bubble-sheet w-full overflow-x-auto">
            <table class="table-auto border-collapse border border-gray-300 w-full">
              <thead>
                <tr class="bg-gray-100 text-black">
                  <th class="border border-gray-300 px-4 py-2">Item #</th>
                  <% ['A', 'B', 'C', 'D', 'E'].each do |option| %>
                    <th class="border border-gray-300 px-4 py-2"><%= option %></th>
                  <% end %>
                </tr>
              </thead>
              <tbody>
                <% range.each do |item_number| %>
                  <tr>
                    <td class="border border-gray-300 px-4 py-2 text-center"><%= item_number %></td>
                    <% ['A', 'B', 'C', 'D', 'E'].each do |option| %>
                      <td class="border border-gray-300 px-4 py-2 text-center">
                        <input type="radio" name="answer_<%= item_number %>" value="<%= option %>" class="w-5 h-5 cursor-pointer accent-primary"
                          <%= 'checked' if params["answer_#{item_number}"] == option %> />
                      </td>
                    <% end %>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
    </div>

    <dialog id="review_answer_key_modal" class="modal">
      <div class="modal-box w-11/12 max-w-5xl">
        <h3 class="text-lg font-bold">Review Answer Key</h3>
        <p class="py-4">Below are the answers you've selected for this exam. Please review them before submitting:</p>
        <div id="answer_key_review" class="overflow-y-auto max-h-96"></div>
        <div class="modal-action">
          <%= form.submit "Add Exam", class: "btn btn-primary" %>
          <button type="button" class="btn" onclick="closeReviewModal()">Close</button>
        </div>
      </div>
    </dialog>

    <div class="mt-4">
      <button type="button" class="btn btn-primary" onclick="openReviewModal()">Review Answer Key</button>
    </div>
  <% end %>
</section>
<%= render "shared/toast", toast: flash[:toast] %>
